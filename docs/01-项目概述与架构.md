# 项目概述与架构设计

## 1. 项目简介

**Data Analysis Agent** 是一个基于人工智能的数据分析平台，专注于基因编辑数据处理和智能报告生成。该系统集成了现代Web技术栈与AI能力，为用户提供便捷的数据上传、分析和报告导出功能。

### 1.1 核心功能

| 功能模块           | 描述                                         |
| ------------------ | -------------------------------------------- |
| **数据上传与解析** | 支持Excel文件上传，自动解析基因编辑实验数据  |
| **智能数据分析**   | AI驱动的数据分析，自动识别突变类型和编辑效率 |
| **报告生成**       | 自动生成Word/PPT格式的专业分析报告           |
| **图像编辑**       | 集成图像编辑器，支持报告图表的二次编辑       |
| **用户认证**       | 完整的用户注册、登录和权限管理系统           |

### 1.2 技术亮点

- **AI Agent架构**: 基于LangChain的智能代理系统
- **全栈TypeScript/Python**: 前端Next.js + 后端Python FastAPI
- **现代化UI**: TailwindCSS + Radix UI组件库
- **容器化部署**: Docker一键部署方案

---

## 2. 技术栈总览

### 2.1 前端技术栈

```
Framework:      Next.js 15.1.4 (App Router)
Language:       TypeScript 5.x
Styling:        TailwindCSS 3.4.1
UI Components:  Radix UI (Dialog, Dropdown, Tabs, Toast等)
State:          Zustand 5.0.2
HTTP Client:    Axios 1.7.9
Charts:         Recharts 2.15.0
Icons:          Lucide React 0.469.0
```

### 2.2 后端技术栈

```
Runtime:        Python 3.10+
Framework:      FastAPI 0.115.6
AI/LLM:         LangChain 0.3.14 + OpenAI/Qwen
Excel处理:      OpenPyXL 3.1.5, Pandas 2.2.3
文档生成:       python-docx 1.1.2, python-pptx 1.0.2
数据验证:       Pydantic 2.10.4
```

### 2.3 数据库与ORM

```
Database:       SQLite (开发) / PostgreSQL (生产)
ORM:            Prisma 6.2.1
Migrations:     Prisma Migrate
```

### 2.4 开发与部署工具

```
容器化:         Docker + Docker Compose
包管理:         npm (前端) + pip (后端)
代码质量:       ESLint 9.x
```

---

## 3. 系统架构设计

### 3.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                         客户端层 (Browser)                      │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                    Next.js 前端应用                         ││
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────┐││
│  │  │ 数据分析 │ │ 图像编辑 │ │ 用户认证 │ │  报告下载/预览   │││
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────────────┘││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                         API网关层                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                   Next.js API Routes                         │ │
│  │  /api/auth/*    /api/upload    /api/excel/*    /api/report   │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                  │
                    ┌─────────────┴─────────────┐
                    ▼                           ▼
┌───────────────────────────┐   ┌───────────────────────────────────┐
│      数据持久层            │   │         Python微服务               │
│  ┌─────────────────────┐  │   │  ┌─────────────────────────────┐  │
│  │   Prisma ORM        │  │   │  │     FastAPI Server          │  │
│  │   ┌─────────────┐   │  │   │  │  ┌───────────────────────┐  │  │
│  │   │   SQLite/   │   │  │   │  │  │   Excel Processor     │  │  │
│  │   │  PostgreSQL │   │  │   │  │  ├───────────────────────┤  │  │
│  │   └─────────────┘   │  │   │  │  │   Report Generator    │  │  │
│  └─────────────────────┘  │   │  │  │   (AI Agent)          │  │  │
└───────────────────────────┘   │  │  └───────────────────────┘  │  │
                                │  └─────────────────────────────┘  │
                                └───────────────────────────────────┘
                                                  │
                                                  ▼
                                ┌───────────────────────────────────┐
                                │           外部服务                  │
                                │  ┌─────────────────────────────┐  │
                                │  │   OpenAI / 通义千问 API      │  │
                                │  └─────────────────────────────┘  │
                                └───────────────────────────────────┘
```

### 3.2 目录结构

```
data_processing/
├── src/                          # Next.js 前端源码
│   ├── app/                      # App Router 页面
│   │   ├── (dashboard)/          # Dashboard路由组
│   │   │   ├── dashboard/        # 主面板
│   │   │   └── layout.tsx        # Dashboard布局
│   │   ├── api/                  # API路由
│   │   │   ├── auth/             # 认证接口
│   │   │   ├── excel/            # Excel处理接口
│   │   │   ├── report/           # 报告生成接口
│   │   │   └── upload/           # 文件上传接口
│   │   ├── image-editor/         # 图像编辑器页面
│   │   ├── layout.tsx            # 根布局
│   │   └── page.tsx              # 首页
│   ├── components/               # React组件
│   │   ├── data-analysis/        # 数据分析相关组件
│   │   ├── image-editor/         # 图像编辑器组件
│   │   ├── layout/               # 布局组件
│   │   └── ui/                   # 通用UI组件
│   ├── lib/                      # 工具库
│   │   ├── auth.ts               # 认证工具
│   │   ├── prisma.ts             # Prisma客户端
│   │   └── utils.ts              # 通用工具函数
│   └── store/                    # Zustand状态管理
│       ├── auth.ts               # 认证状态
│       ├── data-analysis-store.ts # 数据分析状态
│       └── editor-store.ts       # 编辑器状态
├── python_service/               # Python后端服务
│   ├── report_generator/         # 报告生成模块
│   │   ├── agent.py              # AI Agent核心
│   │   ├── data_analyzer.py      # 数据分析器
│   │   ├── gene_editing_processor.py  # 基因编辑处理器
│   │   ├── ppt_generator.py      # PPT生成器
│   │   ├── report_generator.py   # Word报告生成器
│   │   └── prompts.py            # AI提示词模板
│   ├── main.py                   # FastAPI入口
│   ├── excel_processor.py        # Excel处理器
│   └── requirements.txt          # Python依赖
├── prisma/                       # Prisma配置
│   ├── schema.prisma             # 数据库Schema
│   └── migrations/               # 数据库迁移
├── public/                       # 静态资源
├── uploads/                      # 用户上传文件
├── docker-compose.yml            # Docker编排
├── Dockerfile                    # Docker镜像
└── package.json                  # 前端依赖配置
```

### 3.3 数据流向

```
用户上传Excel
      │
      ▼
┌─────────────┐    ┌──────────────┐    ┌─────────────────┐
│ API Routes  │───▶│ Python服务   │───▶│ 文件存储(uploads)│
│ /api/upload │    │ 解析Excel    │    └─────────────────┘
└─────────────┘    └──────────────┘
                          │
                          ▼
                   ┌──────────────┐
                   │ 返回解析数据  │
                   │ (JSON格式)   │
                   └──────────────┘
                          │
                          ▼
┌─────────────────────────────────────────┐
│              前端展示                    │
│  ┌─────────┐ ┌─────────┐ ┌───────────┐  │
│  │ 数据表格 │ │ 统计图表 │ │ 分析结果   │  │
│  └─────────┘ └─────────┘ └───────────┘  │
└─────────────────────────────────────────┘
                          │
                          ▼ (用户点击生成报告)
┌─────────────┐    ┌──────────────┐    ┌─────────────────┐
│ API Routes  │───▶│ AI Agent     │───▶│ LLM API调用     │
│ /api/report │    │ 报告生成器   │    │ (OpenAI/Qwen)   │
└─────────────┘    └──────────────┘    └─────────────────┘
                          │
                          ▼
                   ┌──────────────┐
                   │ 生成报告文件  │
                   │ (DOCX/PPTX)  │
                   └──────────────┘
                          │
                          ▼
                   ┌──────────────┐
                   │ 返回下载链接  │
                   └──────────────┘
```

---

## 4. 核心模块概览

### 4.1 前端模块

| 模块         | 路径                    | 职责                       |
| ------------ | ----------------------- | -------------------------- |
| Dashboard    | `src/app/(dashboard)/`  | 主控制面板，文件上传与分析 |
| Image Editor | `src/app/image-editor/` | 图像编辑功能               |
| Auth API     | `src/app/api/auth/`     | 用户认证接口               |
| Upload API   | `src/app/api/upload/`   | 文件上传处理               |
| Report API   | `src/app/api/report/`   | 报告生成接口               |

### 4.2 后端模块

| 模块                   | 路径                                                        | 职责                 |
| ---------------------- | ----------------------------------------------------------- | -------------------- |
| Main                   | `python_service/main.py`                                    | FastAPI应用入口      |
| Excel Processor        | `python_service/excel_processor.py`                         | Excel文件解析        |
| Gene Editing Processor | `python_service/report_generator/gene_editing_processor.py` | 基因编辑数据专业处理 |
| AI Agent               | `python_service/report_generator/agent.py`                  | LangChain AI代理     |
| Report Generator       | `python_service/report_generator/report_generator.py`       | Word文档生成         |
| PPT Generator          | `python_service/report_generator/ppt_generator.py`          | PPT演示文稿生成      |

### 4.3 数据库模型

| 模型           | 表名             | 用途         |
| -------------- | ---------------- | ------------ |
| User           | `User`           | 用户账户信息 |
| Session        | `Session`        | 用户会话管理 |
| UploadedFile   | `UploadedFile`   | 上传文件记录 |
| AnalysisResult | `AnalysisResult` | 分析结果存储 |

---

## 5. 依赖版本清单

### 5.1 前端依赖 (package.json)

**核心框架:**

```json
{
  "next": "15.1.4",
  "react": "^19.0.0",
  "react-dom": "^19.0.0",
  "typescript": "^5"
}
```

**UI组件库:**

```json
{
  "@radix-ui/react-dialog": "^1.1.4",
  "@radix-ui/react-dropdown-menu": "^2.1.4",
  "@radix-ui/react-label": "^2.1.1",
  "@radix-ui/react-slot": "^1.1.1",
  "@radix-ui/react-tabs": "^1.1.2",
  "@radix-ui/react-toast": "^1.2.4"
}
```

**工具库:**

```json
{
  "axios": "^1.7.9",
  "zustand": "^5.0.2",
  "recharts": "^2.15.0",
  "lucide-react": "^0.469.0",
  "class-variance-authority": "^0.7.1",
  "clsx": "^2.1.1",
  "tailwind-merge": "^2.6.0"
}
```

### 5.2 后端依赖 (requirements.txt)

**Web框架:**

```
fastapi==0.115.6
uvicorn==0.34.0
python-multipart==0.0.20
pydantic==2.10.4
```

**AI/LLM:**

```
langchain==0.3.14
langchain-openai==0.3.0
langchain-community==0.3.14
openai==1.59.4
```

**数据处理:**

```
pandas==2.2.3
openpyxl==3.1.5
numpy==2.2.1
```

**文档生成:**

```
python-docx==1.1.2
python-pptx==1.0.2
```

---

## 6. 环境要求

### 6.1 开发环境

- **Node.js**: v18.0.0+
- **Python**: 3.10+
- **npm**: 8.0.0+
- **pip**: 21.0.0+

### 6.2 生产环境

- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **内存**: 建议4GB+
- **存储**: 建议10GB+

---

## 7. 相关文档索引

| 文档                                    | 描述                                |
| --------------------------------------- | ----------------------------------- |
| [02-前端技术详解](./02-前端技术详解.md) | Next.js架构、组件设计、状态管理详解 |
| [03-后端服务详解](./03-后端服务详解.md) | Python服务、API接口、数据处理详解   |
| [04-数据库设计](./04-数据库设计.md)     | Prisma Schema、数据模型、迁移管理   |
| [05-AI Agent系统](./05-AI-Agent系统.md) | LangChain集成、提示词工程、报告生成 |
| [06-部署与配置](./06-部署与配置.md)     | Docker部署、环境变量、生产配置      |

---

_文档版本: 1.0.0 | 更新时间: 2026-02-10_
